/*! For license information please see sdk.webp.js.LICENSE.txt */
(()=>{var e={483:(e,t,r)=>{e.exports=function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}c=r[a]={exports:{}},t[a][0].call(c.exports,(function(e){return o(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var i=void 0,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,n){(function(e){"use strict";var r,n,o,i,a=e.MutationObserver||e.WebKitMutationObserver,s=a?(r=0,a=new a(l),n=e.document.createTextNode(""),a.observe(n,{characterData:!0}),function(){n.data=r=++r%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((o=new e.MessageChannel).port1.onmessage=l,function(){o.port2.postMessage(0)}),c=[];function l(){var e,t;i=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}i=!1}t.exports=function(e){1!==c.push(e)||i||s()}}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var n=e(1);function o(){}var i={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&h(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n((function(){var n;try{n=t(r)}catch(n){return i.reject(e,n)}n===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,n)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var r=!1;function n(t){r||(r=!0,i.reject(e,t))}function o(t){r||(r=!0,i.resolve(e,t))}var a=v((function(){t(o,n)}));"error"===a.status&&n(a.value)}function v(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(o);return this.state!==c?d(r,this.state===s?e:t,this.outcome):this.queue.push(new u(r,e,t)),r},u.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){i.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},i.resolve=function(e,t){var r=v(f,t);if("error"===r.status)return i.reject(e,r.value);if(r=r.value)h(e,r);else{e.state=s,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callFulfilled(t)}return e},i.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:i.resolve(new this(o),e)},l.reject=function(e){var t=new this(o);return i.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,c=-1,l=new this(o);++c<r;)!function(e,o){t.resolve(e).then((function(e){a[o]=e,++s!==r||n||(n=!0,i.resolve(l,a))}),(function(e){n||(n=!0,i.reject(l,e))}))}(e[c],c);return l},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=-1,s=new this(o);++a<r;)!function(e){t.resolve(e).then((function(e){n||(n=!0,i.resolve(s,e))}),(function(e){n||(n=!0,i.reject(s,e))}))}(e[a]);return s}},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d="local-forage-detect-blob-support",f=void 0,h={},v=Object.prototype.toString,p="readonly",g="readwrite";function m(e){return"boolean"==typeof f?a.resolve(f):(t=e,new a((function(e){var r=t.transaction(d,g),n=i([""]);r.objectStore(d).put(n,"key"),r.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},r.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);e(r||!t||43<=parseInt(t[1],10))}})).catch((function(){return!1})).then((function(e){return f=e})));var t}function b(e){e=h[e.name];var t={};t.promise=new a((function(e,r){t.resolve=e,t.reject=r})),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then((function(){return t.promise})):e.dbReady=t.promise}function y(e){return(e=h[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function S(e,t){if(e=h[e.name].deferredOperations.pop())return e.reject(t),e.promise}function E(e,t){return new a((function(r,n){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);b(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(d)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),y(e)}}))}function _(e){return E(e,!1)}function T(e){return E(e,!0)}function w(e,t){if(!e.db)return 1;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,o=e.version>e.db.version;return n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(o||r)&&(!r||(r=e.db.version+1)>e.version&&(e.version=r),1)}function I(e){return i([function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),o=0;o<t;o++)n[o]=e.charCodeAt(o);return r}(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function A(e){var t=this,r=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(r,e,e),r}function D(e,t,r,n){void 0===n&&(n=1);try{var o=e.db.transaction(e.storeName,t);r(null,o)}catch(o){if(0<n&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),T(e)})).then((function(){return function(e){b(e);for(var t=h[e.name],r=t.forages,n=0;n<r.length;n++){var o=r[n];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,_(e).then((function(t){return e.db=t,w(e)?T(e):t})).then((function(n){e.db=t.db=n;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=n})).catch((function(t){throw S(e,t),t}))}(e).then((function(){D(e,t,r,n-1)}))})).catch(r);r(o)}}var k={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var o=h[r.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},h[r.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=A);var i=[];function s(){return a.resolve()}for(var c=0;c<o.forages.length;c++){var l=o.forages[c];l!==t&&i.push(l._initReady().catch(s))}var u=o.forages.slice(0);return a.all(i).then((function(){return r.db=o.db,_(r)})).then((function(e){return r.db=e,w(r,t._defaultConfig.version)?T(r):e})).then((function(e){r.db=o.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var i=u[n];i!==t&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}}))},_support:function(){try{if(!o)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=new a((function(t,n){r.ready().then((function(){D(r._dbInfo,p,(function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var r,n=a.result;n?(O(r=n.value)&&(r=I(r)),void 0!==(r=e(r,n.key,s++))?t(r):n.continue()):t()},a.onerror=function(){n(a.error)}}catch(o){n(o)}}))})).catch(n)}));return s(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=new a((function(t,n){r.ready().then((function(){D(r._dbInfo,p,(function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;O(e=void 0===e?null:e)&&(e=I(e)),t(e)},a.onerror=function(){n(a.error)}}catch(o){n(o)}}))})).catch(n)}));return s(n,t),n},setItem:function(e,t,r){var n=this;e=l(e);var o=new a((function(r,o){var i;n.ready().then((function(){return i=n._dbInfo,"[object Blob]"===v.call(t)?m(i.db).then((function(e){return e?t:(r=t,new a((function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:r.type})},n.readAsBinaryString(r)})));var r})):t})).then((function(t){D(n._dbInfo,g,(function(i,a){if(i)return o(i);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){r(t=void 0===t?null:t)},a.onabort=a.onerror=function(){var e=c.error||c.transaction.error;o(e)}}catch(i){o(i)}}))})).catch(o)}));return s(o,r),o},removeItem:function(e,t){var r=this;e=l(e);var n=new a((function(t,n){r.ready().then((function(){D(r._dbInfo,g,(function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){n(a.error)},i.onabort=function(){var e=a.error||a.transaction.error;n(e)}}catch(o){n(o)}}))})).catch(n)}));return s(n,t),n},clear:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){D(t._dbInfo,g,(function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error||i.transaction.error;r(e)}}catch(n){r(n)}}))})).catch(r)}));return s(r,e),r},length:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){D(t._dbInfo,p,(function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){r(i.error)}}catch(n){r(n)}}))})).catch(r)}));return s(r,e),r},key:function(e,t){var r=this,n=new a((function(t,n){e<0?t(null):r.ready().then((function(){D(r._dbInfo,p,(function(o,i){if(o)return n(o);try{var a=i.objectStore(r._dbInfo.storeName),s=!1,c=a.openCursor();c.onsuccess=function(){var r=c.result;r?0===e||s?t(r.key):(s=!0,r.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(o){n(o)}}))})).catch(n)}));return s(n,t),n},keys:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){D(t._dbInfo,p,(function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).openCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){r(i.error)}}catch(n){r(n)}}))})).catch(r)}));return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r,n=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),s(r=e.name?(r=e.name===n.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):_(e).then((function(t){var r=h[e.name],n=r.forages;r.db=t;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=t;return t})),e.storeName?r.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;b(e);var n=h[e.name],i=n.forages;t.close();for(var s=0;s<i.length;s++){var c=i[s];c._dbInfo.db=null,c._dbInfo.version=r}return new a((function(t,n){var i=o.open(e.name,r);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<i.length;t++){var r=i[t];r._dbInfo.db=e,y(r._dbInfo)}})).catch((function(t){throw(S(e,t)||a.resolve()).catch((function(){})),t}))}})):r.then((function(t){b(e);var r=h[e.name],n=r.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;return new a((function(t,r){var n=o.deleteDatabase(e.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),r(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<n.length;t++)y(n[t]._dbInfo)})).catch((function(t){throw(S(e,t)||a.resolve()).catch((function(){})),t}))}))):a.reject("Invalid arguments"),t),r}},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:",R=N.length,C="arbf",P="blob",M=R+C.length,B=Object.prototype.toString;function j(e){var t,r,n,o,i=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--),i=new ArrayBuffer(i);for(var c=new Uint8Array(i),l=0;l<a;l+=4)t=x.indexOf(e[l]),r=x.indexOf(e[l+1]),n=x.indexOf(e[l+2]),o=x.indexOf(e[l+3]),c[s++]=t<<2|r>>4,c[s++]=(15&r)<<4|n>>2,c[s++]=(3&n)<<6|63&o;return i}function U(e){for(var t=new Uint8Array(e),r="",n=0;n<t.length;n+=3)r+=x[t[n]>>2],r+=x[(3&t[n])<<4|t[n+1]>>4],r+=x[(15&t[n+1])<<2|t[n+2]>>6],r+=x[63&t[n+2]];return t.length%3==2?r=r.substring(0,r.length-1)+"=":t.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var W={serialize:function(e,t){var r="";if(e&&(r=B.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===B.call(e.buffer))){var n,o=N;e instanceof ArrayBuffer?(n=e,o+=C):(n=e.buffer,"[object Int8Array]"===r?o+="si08":"[object Uint8Array]"===r?o+="ui08":"[object Uint8ClampedArray]"===r?o+="uic8":"[object Int16Array]"===r?o+="si16":"[object Uint16Array]"===r?o+="ur16":"[object Int32Array]"===r?o+="si32":"[object Uint32Array]"===r?o+="ui32":"[object Float32Array]"===r?o+="fl32":"[object Float64Array]"===r?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+U(n))}else if("[object Blob]"===r)(r=new FileReader).onload=function(){var r="~~local_forage_type~"+e.type+"~"+U(this.result);t(N+P+r)},r.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if(e.substring(0,R)!==N)return JSON.parse(e);var t,r=e.substring(M),n=e.substring(R,M);n===P&&L.test(r)&&(t=(e=r.match(L))[1],r=r.substring(e[0].length));var o=j(r);switch(n){case C:return o;case P:return i([o],{type:t});case"si08":return new Int8Array(o);case"ui08":return new Uint8Array(o);case"uic8":return new Uint8ClampedArray(o);case"si16":return new Int16Array(o);case"ur16":return new Uint16Array(o);case"si32":return new Int32Array(o);case"ui32":return new Uint32Array(o);case"fl32":return new Float32Array(o);case"fl64":return new Float64Array(o);default:throw new Error("Unkown type: "+n)}},stringToBuffer:j,bufferToString:U};function H(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function F(e,t,r,n,o,i){e.executeSql(r,n,o,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?i(e,a):H(e,t,(function(){e.executeSql(r,n,o,i)}),i)}),i):i(e,a)}),i)}function q(e,t,r,n){var o=this;e=l(e);var i=new a((function(i,a){o.ready().then((function(){var s=t=void 0===t?null:t,c=o._dbInfo;c.serializer.serialize(t,(function(t,l){l?a(l):c.db.transaction((function(r){F(r,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(s)}),(function(e,t){a(t)}))}),(function(t){t.code===t.QUOTA_ERR&&(0<n?i(q.apply(o,[e,s,r,n-1])):a(t))}))}))})).catch(a)}));return s(i,r),i}var G={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var o=new a((function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction((function(o){H(o,r,(function(){t._dbInfo=r,e()}),(function(e,t){n(t)}))}),n)}));return r.serializer=W,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new a((function(t,n){r.ready().then((function(){var o=r._dbInfo;o.db.transaction((function(r){F(r,o,"SELECT * FROM "+o.storeName,[],(function(r,n){for(var i=n.rows,a=i.length,s=0;s<a;s++){var c=i.item(s),l=(l=c.value)&&o.serializer.deserialize(l);if(void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=new a((function(t,n){r.ready().then((function(){var o=r._dbInfo;o.db.transaction((function(r){F(r,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){r=(r=r.rows.length?r.rows.item(0).value:null)&&o.serializer.deserialize(r),t(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},setItem:function(e,t,r){return q.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=l(e);var n=new a((function(t,n){r.ready().then((function(){var o=r._dbInfo;o.db.transaction((function(r){F(r,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},clear:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){F(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,e),r},length:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){F(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,r){r=r.rows.item(0).c,e(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,e),r},key:function(e,t){var r=this,n=new a((function(t,n){r.ready().then((function(){var o=r._dbInfo;o.db.transaction((function(r){F(r,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){r=r.rows.length?r.rows.item(0).key:null,t(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},keys:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){F(t,n,"SELECT key FROM "+n.storeName,[],(function(t,r){for(var n=[],o=0;o<r.rows.length;o++)n.push(r.rows.item(o).key);e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n=this,o=e.name?new a((function(t){var o,i=e.name===r.name?n._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:i,storeNames:[e.storeName]}):t((o=i,new a((function(e,t){o.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).name);e({db:o,storeNames:n})}),(function(e,r){t(r)}))}),(function(e){t(e)}))}))))})).then((function(e){return new a((function(t,r){e.db.transaction((function(n){for(var o=[],i=0,s=e.storeNames.length;i<s;i++)o.push(function(e){return new a((function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}(e.storeNames[i]));a.all(o).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):a.reject("Invalid arguments");return s(o,t),o}};function z(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function K(e,t){for(var r,n,o=e.length,i=0;i<o;){if((r=e[i])===(n=t)||"number"==typeof r&&"number"==typeof n&&isNaN(r)&&isNaN(n))return 1;i++}}e={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=z(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=W,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=r.ready().then((function(){for(var t=r._dbInfo,n=t.keyPrefix,o=n.length,i=localStorage.length,a=1,s=0;s<i;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var l=(l=localStorage.getItem(c))&&t.serializer.deserialize(l);if(void 0!==(l=e(l,c.substring(o),a++)))return l}}}));return s(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=r.ready().then((function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&t.serializer.deserialize(n)}));return s(n,t),n},setItem:function(e,t,r){var n=this;e=l(e);var o=n.ready().then((function(){var r=t=void 0===t?null:t;return new a((function(o,i){var a=n._dbInfo;a.serializer.serialize(t,(function(t,n){if(n)i(n);else try{localStorage.setItem(a.keyPrefix+e,t),o(r)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||i(t),i(t)}}))}))}));return s(o,r),o},removeItem:function(e,t){var r=this;e=l(e);var n=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(n,t),n},clear:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;0<=r;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return s(r,e),r},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var r=this,n=r.ready().then((function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(n){t=null}return t&&t.substring(n.keyPrefix.length)}));return s(n,t),n},keys:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,n=[],o=0;o<r;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&n.push(i.substring(e.keyPrefix.length))}return n}));return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(n=this.config(),e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,n=e.name?new a((function(t){e.storeName?t(z(e,r._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):a.reject("Invalid arguments");return s(n,t),n}};var Q=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},X={},V={},J={INDEXEDDB:k,WEBSQL:G,LOCALSTORAGE:e},Y=(e=[J.INDEXEDDB._driver,J.WEBSQL._driver,J.LOCALSTORAGE._driver],["dropInstance"]),Z=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Y),$={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ee(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];if(r)for(var n in r)r.hasOwnProperty(n)&&(Q(r[n])?e[n]=r[n].slice():e[n]=r[n])}return e}function te(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,te),J){var r,n;J.hasOwnProperty(t)&&(n=(r=J[t])._driver,this[t]=n,X[n]||this.defineDriver(r))}this._defaultConfig=ee({},$),this._config=ee({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}e=new(te.prototype.config=function(e){if("object"!==(void 0===e?"undefined":n(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},te.prototype.defineDriver=function(e,t,r){var n=new a((function(t,r){try{var n=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(o);for(var i=Z.concat("_initStorage"),c=0,l=i.length;c<l;c++){var u=i[c];if((!K(Y,u)||e[u])&&"function"!=typeof e[u])return void r(o)}!function(){for(var t=0,r=Y.length;t<r;t++){var n=Y[t];e[n]||(e[n]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=a.reject(t),arguments[arguments.length-1]),t}}(n))}}();var d=function(r){X[n]&&console.info("Redefining LocalForage driver: "+n),X[n]=e,V[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,r):d(!!e._support):d(!0)}catch(o){r(o)}}));return c(n,t,r),n},te.prototype.driver=function(){return this._driver||null},te.prototype.getDriver=function(e,t,r){return c(e=X[e]?a.resolve(X[e]):a.reject(new Error("Driver not found.")),t,r),e},te.prototype.getSerializer=function(e){var t=a.resolve(W);return c(t,e),t},te.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(r,e,e),r},te.prototype.setDriver=function(e,t,r){var n=this;Q(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){n._config.driver=n.driver()}function s(e){return n._extend(e),i(),n._ready=n._initStorage(n._config),n._ready}return e=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve(),this._driverSet=e.then((function(){var e=o[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,i(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var o=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(o).then(s).catch(r)}i();var c=new Error("No available storage method found.");return n._driverSet=a.reject(c),n._driverSet}()}}(o)}))})).catch((function(){i();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet})),c(this._driverSet,t,r),this._driverSet},te.prototype.supports=function(e){return!!V[e]},te.prototype._extend=function(e){ee(this,e)},te.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];this.supports(o)&&t.push(o)}return t},te.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Z.length;e<t;e++)!function(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}(this,Z[e])},te.prototype.createInstance=function(e){return new te(e)},te),t.exports=e},{3:3}]},{},[4])(4)}},t={};function r(n){var o=t[n];return void 0!==o||(o=t[n]={exports:{}},e[n](o,o.exports,r)),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{default:()=>ue});const e="number",t="Version not found in staging",o={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com"},i="v1/experiences/web/live",a="v1/experiences/web/test",s="v1/experiences/web/stats",c="moe_webp",l={STORE_NAME:"experiences"},u={STORE_NAME:"meta",LAST_FETCHED_TIME:"last_fetched_time",USER_IN_GCG:"user_in_gcg"},d="MOE_WEBP_MESSAGE_SHOWN",f="MOE_WEBP_MESSAGE_CLICKED";function h(e,t,r){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?h(e,t.slice(1),r):void 0===e?r||null:e:null}class v{static set(e,t){v.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return h(window,"moeInternals.ephemeral."+e,null)}}v.baseLogTag="EphemeralStorage";const p="unifiedLogs",g={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION"},m=2;let b="color: white; background: #41AE55; border-radius: 5px;";class y{static setLogLevel(e,t){var r=y.baseLogTag+".setLogLevel";null==v.get(p)&&v.set(p,[]),null==e?y.logLevel=0:e in[0,1,2]?0<(y.logLevel=e)&&t&&y.releaseAllLogs():y.warn(0,r,"Value",e,"not supported for setDebugLevel(). Current log level is",y.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){y.tagLogStyle=y.tagLogStyle.replace("#48beab",e)}static log(e,t,r,...n){e<=y.logLevel?console.log("%c "+y.logBrand+" %c %c info %c %c "+t+" ",b,"","color: white; background: #18a0bf; border-radius: 5px;","",y.tagLogStyle,r,...n):y.cacheLog((()=>{y.log(e,t,r,...n)}))}static error(e,t,r,...n){e<=y.logLevel?console.error("%c "+y.logBrand+" %c %c error %c %c "+t+" ",b,"","color: white; background: #cc0a0a; border-radius: 5px;","",y.tagLogStyle,r,...n):y.cacheLog((()=>{y.error(e,t,r,...n)}))}static warn(e,t,r,...n){e<=y.logLevel?console.warn("%c "+y.logBrand+" %c %c warn %c %c "+t+" ",b,"","color: white; background: #e8ab51; border-radius: 5px;","",y.tagLogStyle,r,...n):y.cacheLog((()=>{y.warn(e,t,r,...n)}))}static customLabel(e,t,r,...n){e<=y.logLevel?console.log("%c "+y.logBrand+" %c %c "+t+" %c %c "+r+" %c ",b,"",y.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...n):y.cacheLog((()=>{y.customLabel(e,t,r,...n)}))}static image(e,t){e<=y.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):y.cacheLog((()=>{y.image(e,t)}))}static releaseAllLogs(){var e=v.get(p),t=e.length;const r=e;if(v.set(p,[]),0<t){y.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<t;e++)r[e]();y.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){y.logBrand=e}static setBrandColor(e){b="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let t=v.get(p);null==t&&(t=[]),t.push(e),v.set(p,t)}}y.baseLogTag="Logger",y.logBrand="MoEngage",y.logLevel=0,y.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";class S{constructor(){this.items=[]}static enqueue(e,t){e=S.getLocalStorageQName(e);let r=new S;T.get(e)&&(r=T.get(e)),r.items.push(t),r.items=r.items.slice(Math.max(r.items.length-50,0)),T.set(e,r)}static dequeue(e){e=S.getLocalStorageQName(e);const t=T.get(e);let r=null;return t&&0<t.items.length&&(r=t.items[0],t.items.splice(0,1),T.set(e,t)),r}static isEmpty(e){return e=S.getLocalStorageQName(e),!(T.get(e)&&0<T.get(e).items.length)}static purge(e){var t=S.getLocalStorageQName(e);S.isEmpty(e)||T.remove(t)}static getLocalStorageQName(e){return g.Q.PREFIX+"_"+e}}class E{static set(e,t){var r=E.baseTag+".set";null==t?E.remove(e):(t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),y.log(3,r,"Setting ",e,":",t),r=Date.now(),r=";expires="+new Date(r+31536e6*m).toUTCString(),document.cookie=e+"="+encodeURIComponent(t)+r+";domain="+E.getOrigin()+";path=/;SameSite=None; Secure")}static get(e){var t=E.baseTag+".get",r=e+"=",n=decodeURIComponent(document.cookie).split(";");for(let o=n.length-1;0<=o;o--){let i=n[o];for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(r)){let n=i.substring(r.length,i.length);try{n=JSON.parse(n),"string"===h(n,"MOE_DATA_TYPE",null)?(n=h(n,"actualValue",null),n=n?String(n):null):"boolean"===h(n,"MOE_DATA_TYPE",null)&&(n=h(n,"actualValue",null))}catch(e){}return y.log(3,t,"Got ",e,":",n),n}}return null}static remove(e){var t=E.baseTag+".remove";document.cookie=e+"=;domain="+E.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",y.log(3,t,"Removed ",e)}static setRaw(e,t,r){var n=E.baseTag+".setRaw";if(null==t)E.remove(e);else{y.log(3,n,"Setting ",e,":",t);let o="";null!=r&&(o=";expires="+r.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+o+";domain="+E.getOrigin()+";path=/;"}}static getOrigin(){var e=E.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(y.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}E.baseTag="CookieStorage";const _="MOE_DATA";class T{static setPrefix(e){T.prefix=e+"_"}static set(e,t){if(T.baseLogTag,e=T.prefix+e,localStorage){const r=T.getMoeData();r[e]=t,localStorage.setItem(_,JSON.stringify(r))}var r=T.KEYS_SHARED_WITH_COOKIE.indexOf(e);if(T.isSharedWithCookie&&0<=r){const n="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);0===r&&Array.isArray(n.attributes)&&(n.attributes=n.attributes.filter((e=>{switch(e.key){case"USER_ATTRIBUTE_UNIQUE_ID":case"USER_ID_MODIFIED_FROM":case"USER_ATTRIBUTE_USER_EMAIL":case"USER_ATTRIBUTE_USER_MOBILE":return!0;default:return!1}}))),e===g.SUBSCRIPTION_DETAILS&&(n.domain=t.domain,n.token=t.token,n.endpoint=t.endpoint,n.keys=t.keys),E.set(e,n)}}static get(e){return T.baseLogTag,e=T.prefix+e,localStorage?h(T.getMoeData(),e,null):null}static remove(e){var t=T.baseLogTag+".remove",r=T.prefix+e;if(localStorage&&null!=T.get(e)){const n=T.getMoeData();delete n[r],localStorage.setItem(_,JSON.stringify(n)),y.log(2,t,"Key",e,"removed.")}T.isSharedWithCookie&&0<=T.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&E.remove(e)}static logout(){const e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(const t in g)e.indexOf(t)<0&&T.remove(g[t]);for(const e in g.Q)S.purge(e)}static getString(e){if(e=T.prefix+e,localStorage)return"string"==typeof(e=T.get(e))||e instanceof String?e:JSON.stringify(e)}static removePrefix(){T.prefix=""}static copyKeysFromCookie(){for(let r=0;r<T.KEYS_SHARED_WITH_COOKIE.length;r++){var e=T.KEYS_SHARED_WITH_COOKIE[r],t=E.get(e);if(null!=t){const r="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);if(e===g.USER_DATA&&(t=T.get(e)&&T.get(e).attributes,Array.isArray(r.attributes)&&Array.isArray(t)&&0<t.length)){const e=[...t];r.attributes.forEach((t=>{var r=e.findIndex((e=>e.key===t.key));0<=r&&(e[r]=t)})),r.attributes=e}T.set(e,r)}}}static getMoeData(){var e=T.baseLogTag+".getMoeData",t=localStorage.getItem(_);if(null==t)return{};try{return JSON.parse(t)}catch(t){return y.error(1,e,t),{}}}}T.baseLogTag="PersistentStorage",T.prefix="",T.isSharedWithCookie=!1,T.KEYS_SHARED_WITH_COOKIE=[g.USER_DATA,g.SUBSCRIPTION_DETAILS,g.SOFT_ASK_STATUS,g.SETUP_TIME,g.PUSH_TOKEN,g.OPT_IN_SHOWN_TIME,g.HARD_ASK_STATUS];class w{static get(e,t){return w.makeNetworkCall(w.METHODS.GET,e,t)}static post(e,t){return w.makeNetworkCall(w.METHODS.POST,e,t)}static makeNetworkCall(e,t,r={}){return new Promise(((n,o)=>{var i=JSON.stringify(h(r,"postData",null));t=((e,t)=>{e+="?";for(const r in t)t.hasOwnProperty(r)&&null!=t[r]&&(e+=r+"="+encodeURIComponent(t[r])+"&");return e})(t,h(r,"queryParams",null));const a=new XMLHttpRequest;a.open(e,t,!0),w.addRequestHeaders(a,h(r,"headers",{})),a.onreadystatechange=()=>{4===a.readyState&&200===a.status||4===a.readyState&&410===a.status?n({status:a.status,responseText:a.responseText}):4===a.readyState&&200!==a.status&&o({code:a.status,reason:a.responseText})},a.send(i)}))}static addRequestHeaders(e,t){for(const r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r]);return e}}(x=(x=w=w||{}).METHODS||(x.METHODS={})).GET="GET",x.POST="POST";const I=w;var O,A,D,k,x,L=r(483),N=function(e,t,r,n){return new(r=r||Promise)((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};class R{static initialize(){return N(this,void 0,void 0,(function*(){var e;return null==R.ready&&(R.experiencesStore=L.createInstance({driver:[L.INDEXEDDB,L.WEBSQL,L.LOCALSTORAGE],name:c,storeName:l.STORE_NAME}),R.metaStore=L.createInstance({driver:[L.INDEXEDDB,L.WEBSQL,L.LOCALSTORAGE],name:c,storeName:u.STORE_NAME}),e=[R.experiencesStore.ready(),R.metaStore.ready()],R.ready=Promise.all(e)),R.ready}))}static clear(){return N(this,void 0,void 0,(function*(){var e=R.baseLogTag+".clear";try{yield R.initialize(),yield Promise.all([R.experiencesStore.clear(),R.metaStore.clear()]);var t=[R.experiencesStore.ready(),R.metaStore.ready()];R.ready=Promise.all(t)}catch(t){y.error(1,e,"Error clearing web personalization stores:",t)}return R.ready}))}}R.baseLogTag="MOE_WEBP_STORES";class C{constructor(e,t){this.key=e,this.value=t}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}class P{constructor(e,t,r=!0){this.name=e,this.attributes=t,r&&this.attributes.push(new C("URL",location.href))}}(x=O=O||{}).AND="and",x.OR="or",(x=A=A||{}).BOOL="bool",x.STRING="string",x.DATE="datetime",x.NUMBER="double",x.LONG="long";class M{}M.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi;class B{constructor(e,t,r,n){this.dataType=e,this.availableOperations=t,this.event=r,this.filter=n}validate(){return!(this.availableOperations.indexOf(this.filter.operator)<0)}checkEq(){let e=!1;return this.event.attributes.forEach((t=>{let r=t.value,n=this.filter.value;this.dataType===D.STRING&&typeof r===D.STRING&&(r=this.removeSpecialChars(r),n=this.removeSpecialChars(n)),t.key===this.filter.name&&(this.dataType!==D.STRING||this.filter.case_sensitive?r===n&&(e=!0):r.toLowerCase()===n.toLowerCase()&&(e=!0))})),e}checkExists(){let e=!1;return this.event.attributes.forEach((t=>{t.key===this.filter.name&&(e=!0)})),e}removeSpecialChars(e){return e.replace(M.REMOVE_TRAIL_CHARS,"")}}(x=D=D||{}).BOOL="bool",x.STRING="string",x.DATE="datetime",x.NUMBER="double",x.LONG="long",(x=k=k||{}).EQ="is",x.LT="lessThan",x.GT="greaterThan",x.BETWEEN="between",x.IN="in",x.EXISTS="exists",x.CONTAINS="contains",x.STARTSWITH="startsWith",x.ENDSWITH="endsWith",x.INTHELAST="inTheLast",x.INTHENEXT="inTheNext",x.AFTER="after",x.BEFORE="before",x.ON="on",x.TODAY="today";const j=e=>"string"==typeof e,U=e=>"[object Date]"===Object.prototype.toString.call(e),W=[k.EQ,k.EXISTS];class H extends B{constructor(e,t){super(D.BOOL,W,e,t)}evaluate(){let e=!1;switch(this.filter.operator){case k.EQ:e=this.checkEq();break;case k.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e}}H.baseLogTag="BooleanDataType";const F=[k.EXISTS,k.ON,k.BETWEEN,k.BEFORE,k.AFTER,k.INTHELAST,k.INTHENEXT,k.TODAY];class q extends B{constructor(e,t){!U(t.value)&&j(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!U(t.value2)&&j(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!U(t.value1)&&j(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),super(D.DATE,F,e,t)}evaluate(){q.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name));const r=0<t.length?t[0]:null;if(null!=r)switch(r.value.setHours(0,0,0,0),this.filter.operator){case k.EQ:e=this.checkEq();break;case k.EXISTS:e=this.checkExists();break;case k.ON:e=this.checkOn(r);break;case k.BETWEEN:e=this.checkBetween(r);break;case k.BEFORE:e=this.checkBefore(r);break;case k.AFTER:e=this.checkAfter(r);break;case k.INTHELAST:e=this.checkLastX(r);break;case k.INTHENEXT:e=this.checkNextX(r);break;case k.TODAY:e=this.checkToday(r)}return this.filter.negate?!e:e}checkOn(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)}checkBetween(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()}checkBefore(t){const{value:r}=this.filter;return typeof r===e?((new Date).setHours(0,0,0,0)-t.value.setHours(0,0,0,0))/864e5>r:t.value.setHours(0,0,0,0)<r.setHours(0,0,0,0)}checkAfter(t){const{value:r}=this.filter;return typeof r===e?(t.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>r:t.value.setHours(0,0,0,0)>r.setHours(0,0,0,0)}checkLastX(e){var t=(new Date).setHours(0,0,0,0);return 0<t-(e=e.value.setHours(0,0,0,0))&&(t-e)/864e5<=this.filter.value}checkNextX(e){var t=(new Date).setHours(0,0,0,0);return 0<(e=e.value.setHours(0,0,0,0))-t&&(e-t)/864e5<=this.filter.value}checkToday(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)}}q.baseLogTag="DateTimeDataType";const G=[k.EQ,k.EXISTS,k.GT,k.LT,k.BETWEEN,k.IN];class z extends B{constructor(e,t){super(D.NUMBER,G,e,t)}evaluate(){z.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name)),r=0<t.length?t[0]:null;if(null!=r&&"number"==typeof r.value)switch(this.filter.operator){case k.EQ:e=this.checkEq();break;case k.EXISTS:e=this.checkExists();break;case k.GT:e=this.checkGreaterThan(r);break;case k.LT:e=this.checkLessThan(r);break;case k.BETWEEN:e=this.checkBetween(r);break;case k.IN:e=this.checkIn(r)}return this.filter.negate?!e:e}checkGreaterThan(e){return e.value>this.filter.value}checkLessThan(e){return e.value<this.filter.value}checkBetween(e){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=e.value&&e.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=e.value&&e.value<this.filter.value1}checkIn(e){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(e.value)}}z.baseLogTag="NumberDataType";const K=[k.EQ,k.EXISTS,k.CONTAINS,k.STARTSWITH,k.ENDSWITH,k.IN];class Q extends B{constructor(e,t){super(D.STRING,K,e,t)}evaluate(){Q.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name)),r=0<t.length?t[0]:null;if(null!=r&&j(r.value))switch(this.filter.operator){case k.EQ:e=this.checkEq();break;case k.EXISTS:e=this.checkExists();break;case k.CONTAINS:e=this.checkContains(r);break;case k.STARTSWITH:e=this.checkStartsWith(r);break;case k.ENDSWITH:e=this.checkEndsWith(r);break;case k.IN:e=this.checkIn(r)}return this.filter.negate?!e:e}checkContains(e){return this.filter.case_sensitive?0<=e.value.indexOf(this.filter.value):0<=e.value.toLowerCase().indexOf(this.filter.value.toLowerCase())}checkStartsWith(e){var t=(e,t)=>e.substr(0,t.length)===t;return this.filter.case_sensitive?t(e.value,this.filter.value):t(e.value.toLowerCase(),this.filter.value.toLowerCase())}checkEndsWith(e){var t=(e,t,r)=>((void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t);if(this.filter.case_sensitive)return t(e.value,this.filter.value);const r=this.removeSpecialChars(e.value),n=this.removeSpecialChars(this.filter.value);return t(r.toLowerCase(),n.toLowerCase())}checkIn(e){let t=!1;if(Array.isArray(this.filter.value))for(let r=this.filter.value.length-1;0<=r;r--)if(this.filter.case_sensitive){if(this.filter.value[r]===e.value){t=!0;break}}else if(this.filter.value[r].toLowerCase()===e.value.toLowerCase()){t=!0;break}return t}}Q.baseLogTag="StringDataType";class X{static doesEventMatchFilters(e,t){X.baseLogTag;let r=!1,n=null;switch(t.data_type){case A.BOOL:n=new H(e,t),n.validate()&&(r=n.evaluate());break;case A.STRING:n=new Q(e,t),n.validate()&&(r=n.evaluate());break;case A.NUMBER:case A.LONG:n=new z(e,t),n.validate()&&(r=n.evaluate());break;case A.DATE:n=new q(e,t),n.validate()&&(r=n.evaluate())}return r}static doesValueMatchFilter(e,t){return e=new C(t.name,e),e=new P("sample event",[e]),X.doesEventMatchFilters(e,t)}}X.baseLogTag="TriggerEvaluator";var V=function(e,t,r,n){return new(r=r||Promise)((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};function J(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}function Y(e){return new Date(Date.parse(e))}const Z=()=>window.Moengage,$=()=>{var e=re(window.location.search);return e.moeWpE&&"1"===e.moeWpE},ee=()=>{var e=re(window.location.search);return!e.MoeWpLive||"0"!==e.MoeWpLive};function te(){var e;const t=document.currentScript;let r,n,i,a="DC_1",s="sdk-01.moengage.com";if(t){let c=t.src.split("?");return c=null===(e=c[1])||void 0===e?void 0:e.split("&"),null!=c&&c.forEach((e=>{var t;e.includes("app_id")?r=e.split("=")[1]||"":e.includes("env")?n=e.split("=")[1]||"":e.includes("cluster")?(t=e.split("=")[1],o[t]&&(a=t)):e.includes("debug_logs=1")?r+="_DEBUG":e.includes("api_proxy_domain")&&(i=e.split("=")[1]||"")})),n?s="https://"+n+"/":a&&(s="https://"+o[a]+"/"),i&&(s="https://"+i+"/"),{APP_ID:r,HOST:s,CLUSTER:a}}return{}}const re=e=>{if(e){const t=e.replace("?","").split("&"),r={};return t.forEach((e=>{e=(t=e.split("="))[0];var t=decodeURIComponent(t[1]||"");r[e]?"[object Array]"===Object.prototype.toString.call(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t})),JSON.parse(JSON.stringify(r))}return{}};function ne(e,t){window.MoeWebP.statsData[e]=t}class oe{static initiate(e,t,r,n){var o=oe.baseLogTag+".initiate";if(!e||!e.selector||!e.type)return y.error(1,o,"Either selector or type is missing:",e),{success:!1,reason:"invalid query selector or type",operation:e};let i;switch(o=e.type){case"insert":i=oe.handleInsertOp(e,r);break;case"replace":i=oe.handleReplaceOp(e,r);break;case"update":i=oe.handleUpdateOp(e,r);break;case"delete":i=oe.handleDeleteOp(e,r);break;case"hide":i=oe.handleHideOp(e,r);break;case"attribute":i=oe.handleAttributeOp(e,r);break;case"tracking":i=oe.handleTrackingOp(e,r,t,n)}return i}static handleInsertOp(e,t){var r=oe.baseLogTag+".handleInsertOp";if(e.content&&e.placement){const n=t.querySelector(null==e?void 0:e.selector);return n?(t=J(null==e?void 0:e.content),"after"===e.placement?n.parentNode.insertBefore(t,n.nextSibling):"before"===e.placement&&n.parentNode.insertBefore(t,n),y.log(2,r,"Operation applied successfully: ",e),{success:!0}):(y.error(1,r,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e})}return y.error(1,r,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleReplaceOp(e,t){var r=oe.baseLogTag+".handleReplaceOp";if(e.content){const n=t.querySelector(e.selector);return t=J(e.content),n&&t?(n.replaceWith(t),y.log(2,r,"Operation applied successfully: ",e),{success:!0}):(y.error(1,r,"invalid "+(n?"content ->":"query selector -> "),e),{success:!1,reason:"invalid "+(n?"content":"query selector"),operation:e})}return y.error(1,r,"Unable to find content.",e),{success:!1,reason:"unable to find  content.",operation:e}}static handleUpdateOp(e,t){var r=oe.baseLogTag+".handleUpdateOp";if(e.content){const n=t.querySelector(e.selector);return n?(n.innerHTML=e.content,y.log(2,r,"Operation applied successfully: ",e),{success:!0}):(y.error(1,r,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e})}return y.error(1,r,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e}}static handleDeleteOp(e,t){var r=oe.baseLogTag+".handleDeleteOp";const n=t.querySelector(e.selector);return n?(n.remove(),y.log(2,r,"Operation applied successfully: ",e),{success:!0}):(y.error(1,r,"invalid query selector ->",e),{success:!1,reason:"invalid query selector.",operation:e})}static handleHideOp(e,t){var r=oe.baseLogTag+".handleHideOp";const n=t.querySelector(e.selector);return n&&n.style?(n.style.display="none",y.log(2,r,"Operation applied successfully: ",e),{success:!0}):(y.error(1,r,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e})}static handleAttributeOp(e,t){var r=oe.baseLogTag+".handleAttributeOp";if(e.attributes){const n=t.querySelector(e.selector);return n?(Object.keys(e.attributes).forEach((t=>{var r;"style"===t?(r=n.getAttribute(t)||"",r=function(e){let t="";return Object.keys(e).forEach((r=>{t=t+r+":"+e[r]+";"})),t}(e.attributes[t])+r,n.setAttribute(t,r)):n.setAttribute(t,e.attributes[t])})),y.log(2,r,"Operation applied successfully: ",e),{success:!0}):(y.error(1,r,"invalid "+(n?"attributes":"query selector "),e),{success:!1,reason:n?"unable to find attributes.":"invalid query selector",operation:e})}return y.error(1,r,"Unable to find attributes.",e),{success:!1,reason:"unable to find attributes.",operation:e}}static handleTrackingOp(e,t,r,n){var o=oe.baseLogTag+".handleTrackingOp";if(e.id&&n){const n=t.querySelector(e.selector);return n&&e.id?(n.addEventListener("click",(()=>{Z().track_event(f,Object.assign({id:e.id},r))})),y.log(2,o,"Operation applied successfully: ",e),{success:!0}):(y.error(1,o,"invalid "+(n?"ID ":"query selector "),e),{success:!1,reason:n?"unable to track ID.":"invalid query selector",operation:e})}return y.error(1,o,"Unable to find ID or it is not a Live Experience.",e),{success:!1,reason:"unable to find ID or it is not a Live Experience.",operation:e}}}oe.baseLogTag="DomManipulator";var ie=function(e,t,r,n){return new(r=r||Promise)((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};class ae{constructor(){var e=te();this.appId=e.APP_ID,this.host=e.HOST,this.deviceType=function(){var e=navigator.userAgent.toLowerCase();return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e)?"tablet":function(){const e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}()?"mobile":"web"}()}getLiveExperiences(){return ie(this,void 0,void 0,(function*(){return new Promise(((e,t)=>ie(this,void 0,void 0,(function*(){this.makeAPICall(i,void 0,!0).then((t=>{var r;r=new Date,V(void 0,void 0,void 0,(function*(){var e;return yield null===(e=R.metaStore)||void 0===e?void 0:e.setItem(u.LAST_FETCHED_TIME,r)})),e(t)})).catch((e=>{t(e)}))}))))}))}getTestExperiences(){return ie(this,void 0,void 0,(function*(){return new Promise(((e,t)=>ie(this,void 0,void 0,(function*(){e(this.makeAPICall(a))}))))}))}sendStats(e){return ie(this,void 0,void 0,(function*(){return new Promise(((t,r)=>ie(this,void 0,void 0,(function*(){t(this.makeAPICall(s,e,!1,!0))}))))}))}makeAPICall(e,t,r,n){const o=ae.baseLogTag+".makeAPICall";return new Promise(((i,a)=>{var s="web"===this.deviceType?"web":"mweb",c=function(){const e=new Date;return{day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],hours:String(e.getHours()).padStart(2,"0")}}(),l=re(window.location.search),u=T.get("USER_DATA");const d={headers:{},queryParams:Object.assign(Object.assign({},l),{app_id:n?void 0:this.appId,unique_id:(null==u?void 0:u.deviceUuid)||"",sdk_ver:"2.13.3",platform:s,payload_id:l.payload_id,USER_TYPE:1<(h(T.get("SESSION"),"numberOfSessions")||0)?"Returning":"New",DAY_OF_THE_WEEK:c.day,TIME_OF_THE_DAY:c.hours}),postData:t};n&&(d.headers={"MOE-APPKEY":this.appId,"Content-Type":"application/json"});try{if(t)I.post(""+this.host+e,d).then((e=>{e=JSON.parse(e.responseText),i(e)}));else{const t=(new Date).getTime();y.log(1,o,`API requested Start Time: ${e} -> `,t),I.get(""+this.host+e,d).then((n=>{var a=JSON.parse(n.responseText);y.log(1,o,"Get WebP API call success, response: ",a),n=(new Date).getTime(),y.log(1,o,`API response received Time : ${e} -> `,n),r&&(ne("api_start_time",t),ne("api_end_time",n)),i(a)}))}}catch(s){y.error(1,o,"Error getting WebP Test Expressions: ",s),t||(c=(new Date).getTime(),r&&ne("api_request_failed_time",c)),a("Error getting WebP Expressions")}}))}}ae.baseLogTag="WebPApi";class se{static listenToDOMChanges(e,t,r,n,o){se.baseLogTag;var i=o?document:document.querySelector(e.selector);const a=document.location.href,s=new MutationObserver((i=>{let c=!0;var l=a!==document.location.href;i.forEach((e=>{var t;("childList"===e.type&&(null===(t=e.removedNodes[0])||void 0===t?void 0:t.nodeValue)===(null===(t=e.addedNodes[0])||void 0===t?void 0:t.nodeValue)||"attributes"===e.type)&&(c=!1)})),c&&(o?this.domObserver(o):l||this.selectorObserver(e,t,r,n)),(ue.failedOperations.length<1||l)&&s.disconnect()}));s.observe(i,{childList:!0,subtree:!0,attributes:!0,characterData:!0})}static selectorObserver(e,t,r,n){var o=se.baseLogTag+".documentObserver";y.log(1,o,"Reapplying the operation: ",e),oe.initiate(e,t,r,n).success&&se.listenToDOMChanges(e,t,r,n)}static domObserver(e){e()}}se.baseLogTag="Webp.Listener";var ce=function(e,t,r,n){return new(r=r||Promise)((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};const le=te();class ue{constructor(){this.statsData={},this.retryExperienceCount=0;const e=ue.baseLogTag+".constructor";var r,n;new RegExp(["bot","spider","crawler","crawling","Applebot","PetalBot","pingbot","proximic","AdsBot-Google","Googlebot","Cincraw","SnapchatBot","Snapchat-Proxy/1.0","SnapchatAds","Snapchat-Ads/1.0","YandexRenderResourcesBot","bingbot","slurp","MicrosoftPreview","Baiduspider"].join("|"),"i").test(navigator.userAgent)?y.error(1,e,"Bot detected, Can't initialise the MoEngage WebP SDK"):(this.WebPApis=new ae,r=(new Date).getTime(),this.isLiveExperience=!1,y.log(1,e,"WEBP SDK Loaded :",r),this.isSentryEnabled()&&("1"===(null==(n=re(window.location.search))?void 0:n.moeWpT)?(this.WebPApis.getTestExperiences().then((e=>{this.DomManipulator(null==e?void 0:e.payload)})),y.log(1,e,"Web P Test Campaign Dom Manipulation.")):$()?this.getEditorVersion().then((r=>{r===t?(this.injectEditorFile("https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.staging.js"),y.log(1,e,"Web P module initialized in staging editor mode. Version not found, loading default staging editor.")):(this.injectEditorFile((e=>`https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.${e}.js`)(r)),y.log(1,e,"Web P module initialized in editor mode."))})):ee()&&(this.statsData.webP_initialization_time=r,R.initialize(),this.handleLiveExperience())))}handleLiveExperience(){const e=ue.baseLogTag+".handleLiveExperience";this.syncExperiences().then((t=>ce(this,void 0,void 0,(function*(){var r;t&&t.experiences&&t.experiences.length&&(r=yield V(void 0,void 0,void 0,(function*(){const e=[];let t=window.location.origin+window.location.pathname;const r=[];return t=t.replace(/\/$/,""),yield R.experiencesStore.iterate(((n,o)=>{n.url_filters?function(e){const t=(e=>h(e,"url_filters.filters",[]))(e);let r=!0;if(t&&0<t.length){const i=new P("MOE_PAGE_VIEWED",[]);var n=e.url_filters.filter_operator,o=t.map((e=>X.doesEventMatchFilters(i,e)));r=o[0];for(let e=0;e<o.length;e++)if(n===O.AND){if(r=r&&o[e],!1===r)break}else if(n===O.OR&&(r=r||o[e],!0===r))break}return r}(n)?e.push(n):r.push(o):n.url===t?e.push(n):r.push(o)})),0<r.length&&(ne("current_url",t),ne("url_failed_experiences",r)),e})),ue.experience=r&&r[0]&&(e=>{const t=[];return e=e.filter((e=>!!(e&&Y(e.expiry_time+"Z")>new Date)||(t.push(e.id),!1))),0<t.length&&ne("expired_experiences",t),e=e.sort(((e,t)=>t.delivery.priority-e.delivery.priority)),(e=>{var t=e&&(null===(o=e[0])||void 0===o?void 0:o.delivery.priority);let r=e[0],n=0;for(;n<e.length;){if(e[n].delivery.priority!==t){n=e.length;break}0<Y(e[n].updated_time+"Z").getTime()-Y(r.updated_time+"Z").getTime()&&(r=e[n]),n++}var o=e.reduce(((e,t)=>(t.id!==r.id&&e.push(t.id),e)),[]);return 0<o.length&&ne("low_priority_experiences",o),r})(e)})(r),null!==(r=ue.experience)&&void 0!==r&&r.id&&ne("id",ue.experience.id),ue.experience&&ue.experience.gcg_enabled&&t.user_in_gcg?(ne("in_gcg",{experience:ue.experience.gcg_enabled,user:t.user_in_gcg}),y.log(1,e,"GCG is Enabled for both User and Experience: ",{experience:ue.experience,userIsGCG:t.user_in_gcg}),new Promise((()=>{this.WebPApis.sendStats(Object.assign(Object.assign({},ue.experience.context),{gcg_event:!0})),this.WebPApis.sendStats(this.statsData).then((e=>{null!=e&&e.success&&(this.statsData={})}))}))):ue.experience?(y.log(1,e,"Going to trigger this experience: ",ue.experience),this.isLiveExperience=!0,ue.experience&&this.DomManipulator(ue.experience.payload,void 0,ue.experience.context)):(y.log(1,e,"No eligible experience found"),new Promise((()=>{this.WebPApis.sendStats(this.statsData).then((e=>{null!=e&&e.success&&(this.statsData={})}))}))))}))))}syncExperiences(){return ce(this,void 0,void 0,(function*(){const e=ue.baseLogTag+".syncExperiences";return new Promise(((t,r)=>ce(this,void 0,void 0,(function*(){try{var n,o,i,a=yield V(void 0,void 0,void 0,(function*(){var e;return yield null===(e=R.metaStore)||void 0===e?void 0:e.getItem(u.LAST_FETCHED_TIME)}));l=a,l=(new Date).getTime()-new Date(l).getTime(),15<=Math.round(l/6e4)||!a?(y.log(1,e,"synchronizing experiences as time limit exceeded"),yield V(void 0,void 0,void 0,(function*(){yield R.experiencesStore.clear(),yield R.metaStore.clear()})),n=yield this.WebPApis.getLiveExperiences(),c=n&&n.user_in_gcg,yield V(void 0,void 0,void 0,(function*(){var e;return yield null===(e=R.metaStore)||void 0===e?void 0:e.setItem(u.USER_IN_GCG,c)})),s=n.experiences,yield V(void 0,void 0,void 0,(function*(){yield Promise.all(s.map((e=>{R.experiencesStore.setItem(e.id,e)})))})),t(n)):(o=yield V(void 0,void 0,void 0,(function*(){const e=[];return yield R.experiencesStore.iterate((t=>{e.push(t)})),e})),i=yield V(void 0,void 0,void 0,(function*(){var e;return yield null===(e=R.metaStore)||void 0===e?void 0:e.getItem(u.USER_IN_GCG)})),t({experiences:o,user_in_gcg:i}),y.log(1,e,"Using the cached experiences for Web Personalisation"))}catch(n){y.error(1,e,"Error syncing Experiences: ",n),r("Error syncing Experiences")}var s,c,l}))))}))}DomManipulator(e,t=document,r){const n=ue.baseLogTag+".DomManipulator";this.domManipulatorStartTime=(new Date).getTime(),y.log(1,n,null!=r&&r.cid?`Going to render experience with ID: ${r.cid} and `:" Operations: ",e),y.log(1,n,"Dom Manipulator start Time: ",this.domManipulatorStartTime),e.forEach((e=>{try{oe.initiate(e,r,t,this.isLiveExperience).success?"insert"!==e.type&&(se.listenToDOMChanges(e,r,t,this.isLiveExperience),ue.isAnyOperationSuccessfull||(ue.isAnyOperationSuccessfull=!0)):ue.failedOperations=ue.failedOperations.concat([[e,r,t,this.isLiveExperience]])}catch(e){y.error(2,n,"Error in Dom Manipulation",e)}})),ue.failedOperations.length?(this.completeDomManipulationTimer=setTimeout((()=>{this.handleDomManipulationComplete(r,this.retryFailedOperations)}),3e4),se.listenToDOMChanges(null,null,null,null,this.retryFailedOperations.bind(this))):this.handleDomManipulationComplete(r,[],!0)}retryFailedOperations(){var e=ue.baseLogTag+".startRetry";y.log(2,e,"Retrying failed operations: ",ue.failedOperations);var t=ue.failedOperations.concat([]);ue.failedOperations=[],t=this.handleRetry(t),this.retryExperienceCount++,0===ue.failedOperations.length&&(y.log(2,e,"Total number of times retried applying webP changes: ",this.retryExperienceCount-1),clearTimeout(this.completeDomManipulationTimer),this.handleDomManipulationComplete(ue.experience.context,t))}handleRetry(e){const t=[];for(;0<e.length;){var r=e.pop(),n=oe.initiate.apply(null,r);n.success?"insert"!==r[0].type&&(se.listenToDOMChanges.apply(null,r),ue.isAnyOperationSuccessfull||(ue.isAnyOperationSuccessfull=!0)):(t.push(n),ue.failedOperations=ue.failedOperations.concat([r]))}return t}handleDomManipulationComplete(e,t,r){var n=ue.baseLogTag+".handleDomManipulationComplete",o=(new Date).getTime();y.log(1,n,"Dom end Time: ",o),y.log(1,n,`Total time taken to manipulate the DOM: ${(o-this.domManipulatorStartTime)/1e3}s`),this.isLiveExperience&&(t&&t.length&&ne("payload_failer",{reason:"Experiences payload Failed to Execute",campaign_id:null==e?void 0:e.cid,data:t}),ne("dom_manipulator_start_time",this.domManipulatorStartTime),ne("dom_manipulator_end_time",o),new Promise((()=>{this.WebPApis.sendStats(this.statsData).then((e=>{null!=e&&e.success&&(this.statsData={})}))})),(ue.isAnyOperationSuccessfull||r)&&this.track(ue.experience))}getEditorVersion(){return ce(this,void 0,void 0,(function*(){const e=ue.baseLogTag+".getEditorVersion";return new Promise(((r,n)=>ce(this,void 0,void 0,(function*(){var o=re(window.location.search);if(function(){const e=te().HOST;return e&&e.includes("moestaging")}())return o.webPStagingVersion&&r(o.webPStagingVersion),void r(t);var i=yield I.get("https://app-cdn.moengage.com/personalization-ui/editor/version.json");if(200===i.status)try{var a=JSON.parse(i.responseText);"1"===o.pre_prod&&r(a.PRE_PROD),r(a[le.CLUSTER]||"")}catch(o){y.error(2,e,"Error in getting editor version file",o),n(o)}r("")}))))}))}injectEditorFile(e){return ce(this,void 0,void 0,(function*(){return new Promise(((t,r)=>ce(this,void 0,void 0,(function*(){const t=document.createElement("script");t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}))))}))}track(e){var t=ue.baseLogTag+".track";Z()?(y.log(1,t,d+": Event Tracked"),Z().track_event(d,Object.assign({campaign_id:e.id},e.context))):(window.moengage_q=window.moengage_q||[]).push({f:"track_event",a:[d,Object.assign({campaign_id:e.id},e.context)]})}isSentryEnabled(){var e=ue.baseLogTag+".isSentryEnabled";try{var t=JSON.parse(localStorage.getItem("MOE_DATA"));return!t||!t.WEB_SETTINGS||"allowed"===t.WEB_SETTINGS.c_w_p_e}catch(t){y.error(1,e,"Error in getting sentry flag for webp: ",t)}}clearLastFetchedTime(){return ce(this,void 0,void 0,(function*(){return y.log(1,"MoeWebP.clearLastFetchedTime","Clearing cache for Web Personalisation"),yield V(void 0,void 0,void 0,(function*(){var e;return yield null===(e=R.metaStore)||void 0===e?void 0:e.removeItem(u.LAST_FETCHED_TIME)}))}))}isEditorModeEnabled(){return $()||!ee()}setLogLevel(e){y.setLogLevel(e,!1),y.setLogTabStyle("#85586F")}}ue.baseLogTag="Web Personalisation",ue.failedOperations=[],ue.isAnyOperationSuccessfull=!1,window.MoeWebP=new ue})()})();